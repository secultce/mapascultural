#!/usr/bin/env php
<?php

require dirname(__DIR__, 2).'/vendor/autoload.php';
require dirname(__DIR__, 2).'/public/bootstrap.php';

use App\Command\CodeStyleCommand;
use App\Command\DebugRouterCommand;
use App\Command\FixturesCommand;
use App\Command\TestsCommand;
use App\Command\WelcomeCommand;
use Symfony\Component\Console\Application;
use Symfony\Component\Dotenv\Dotenv;

$env = dirname(__DIR__, 1).'/.env';

if (false === file_exists($env)) {
    die('Please create a .env file in the root directory (/app/.env)'.PHP_EOL);
}

$dotenv = new Dotenv();
$dotenv->load($env);

$application = new Application();
$entityManager = $app->em ?? null;

$application->addCommands([
    new WelcomeCommand(),
    new TestsCommand(),
    new CodeStyleCommand(),
    new DebugRouterCommand(),
]);

if ('local' === $_ENV['APP_ENV']) {
    $application->addCommands([new FixturesCommand($entityManager)]);
}

$application->run();
